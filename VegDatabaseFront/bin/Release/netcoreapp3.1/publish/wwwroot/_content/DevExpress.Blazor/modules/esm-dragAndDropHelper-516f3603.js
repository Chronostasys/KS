import"./esm-chunk-eaca7b99.js";import{EnsureElement as t,DetachEventFromElement as e,AttachEventToElement as i,EraseBlazorIdentificators as r}from"./esm-dom-utils-0302a1f6.js";import"./esm-chunk-5735fd9a.js";import{T as o}from"./esm-chunk-95f7350d.js";class n{constructor(e,i,r,o){this.itemForDrag=e,t(this.itemForDrag),this.container=i,this.GetDropTarget=r,this.clean=!1,o&&(this.dragAnchor=this.itemForDrag.querySelector(o)),this.dragAnchor||(this.dragAnchor=this.itemForDrag);var n=this;this.container.size=function(){return g(n.container).size},this.itemForDrag.size=function(){return g(n.itemForDrag).size},this.itemForDrag.location=function(){return g(n.itemForDrag).location},this.Reset()}dropEvents(){this.handlerDragStart&&this.itemForDrag&&e(this.dragAnchor,o.touchMouseDownEventName,this.handlerDragStart),this.handlerDrag&&e(document,o.touchMouseMoveEventName,this.handlerDrag),this.handlerDragEnd&&e(document,o.touchMouseUpEventName,this.handlerDragEnd)}dropTempObject(){this.currentPoint=null,this.startPoint=null,this.cloneForMove&&(this.cloneForMove.parentNode.removeChild(this.cloneForMove),this.cloneForMove=null)}Reset(){if(!this.clean){this.clean=!0,this.dropTempObject(),this.dropEvents();var t=this;this.handlerDragStart=function(e){t.dragTriger(e)},i(this.dragAnchor,o.touchMouseDownEventName,this.handlerDragStart)}}Stop(){this.clean=!1,this.dropEvents()}Dispose(){this.dropTempObject(),this.dropEvents(),this.onDragStart=null,this.onDrag=null,this.onDrop=null,this.onDragEndAnimateEnd=null,this.onDragCancel=null,this.itemForDrag=null,this.container=null}get cursor(){return this.cursorPoint}get isScrollActive(){if(!this.scrollContainer.classList.contains("modal-body"))return!1;for(var t=this.scrollContainer.getBoundingClientRect(),e=0,i=this.scrollContainer.children,r=0;r<i.length;r++)e+=i[r].getBoundingClientRect().height;return e!==t.height}get scrollContainer(){return this.container.parentNode}dragTriger(t){this.updateCursor(t);var r=this.cursor.clone(),n=this,s=function(e){return n.updateCursor(e),a(r,"-",n.cursor).scalarLength>3&&(h(),n.clean=!1,n.dragStart(t)),e.preventDefault(),!1},h=function(){e(document,o.touchMouseMoveEventName,s),e(document,o.touchMouseUpEventName,h)};return i(document,o.touchMouseMoveEventName,s),i(document,o.touchMouseUpEventName,h),t.preventDefault(),!1}dragStart(t){if(this.itemForDrag){var n,s;this.updateCursor(t),this.handlerDragStart&&e(this.dragAnchor,o.touchMouseDownEventName,this.handlerDragStart),this.cloneForMove=((s=(n=this.itemForDrag).cloneNode(!0)).center=function(){return g(s).center},s.size=function(){return g(s).size},s.style.transition="none",s.style.width=n.offsetWidth+"px",s.style.visibility="invisible",s.classList.add("in-drag"),r(s),s),this.itemForDrag.parentNode.insertBefore(this.cloneForMove,this.itemForDrag),this.onDragStart&&this.onDragStart(this.itemForDrag),this.scrollingCorrection={x:0,y:0},this.scrollingStart=this.scrollContainer.scrollTop;var h=this;this.handlerDrag=function(t){h.drag(t)},i(document,o.touchMouseMoveEventName,this.handlerDrag),this.handlerDragEnd=function(t){h.dragEnd(t)},i(document,o.touchMouseUpEventName,this.handlerDragEnd)}}drag(t){if(this.itemForDrag&&this.cloneForMove){if(this.updateCursor(t),this.scroll(),!this.startPoint)return this.startPoint=this.itemForDrag.location(),this.currentPoint=this.cursor.clone(),this.cloneForMove.style.visibility="visible",void 0;var e=this.container;this.isScrollActive&&(e=this.scrollContainer);var i=a(e,"-",this.cloneForMove.size()),r=this.cursor.LimitByRectangle(i);this.currentPoint=r,this.translateToPosition(this.cloneForMove,a(this.currentPoint,"-",this.startPoint,"+",this.scrollingCorrection),0),this.onDrag&&(t.centerOfDraggingObject=this.toRelativeCoord(this.cloneForMove.center()),this.onDrag(this.itemForDrag,t))}}dragEnd(t){if(this.itemForDrag&&this.cloneForMove&&this.startPoint){this.handlerDrag&&e(document,o.touchMouseMoveEventName,this.handlerDrag),this.handlerDragEnd&&e(document,o.touchMouseUpEventName,this.handlerDragEnd);var i=this.GetDropTarget(this.toRelativeCoord(this.cloneForMove.center())),r=this;if(i&&this.itemForDrag!==i.item){var n=a(this.toRealCoordinates(i.relativeRect),"+",this.scrollingCorrection,"+",{y:2});this.onDrop&&this.onDrop(this.itemForDrag,i.item);return this.animateItem(this.cloneForMove,a(n,"-",this.startPoint),(function(){r.cloneForMove&&(r.cloneForMove.style["box-shadow"]="none"),r.onDropAnimationEnd&&r.onDropAnimationEnd(r.itemForDrag,i.item)})),void 0}this.cloneForMove&&this.animateItem(this.cloneForMove,{x:0,y:0},(function(){r.onDragCancel(r.itemForDrag),r.Reset()}))}}scroll(){if(this.isScrollActive){var t,e=0,i=this.scrollContainer.getBoundingClientRect();this.cursor.y+this.cloneForMove.size().height-2>i.bottom?(e=this.cursor.y+this.cloneForMove.size().height-i.bottom+2,t={x:0,y:Math.min(this.scrollContainer.scrollTop+e,this.container.size().height-i.height)-this.scrollContainer.scrollTop}):this.cursor.y-2<i.top&&(e=this.cursor.y-i.top-2,t={x:0,y:Math.max(this.scrollContainer.scrollTop+e,0)-this.scrollContainer.scrollTop}),t&&(this.scrollContainer.scrollTop=this.scrollContainer.scrollTop+t.y,this.scrollingCorrection={y:this.scrollContainer.scrollTop-this.scrollingStart})}}updateCursor(t){this.cursorPoint=new s(this.getClientEventPos(t,"clientX"),this.getClientEventPos(t,"clientY")-this.itemForDrag.size().height/2)}translateToPosition(t,e,i){t.style.transition="all "+i+"s";var r=["translate(",Math.round(e.x),"px, ",Math.round(e.y),"px)"].join("");return r!==t.style.transform&&(t.style.transform=r,!0)}animateItem(t,e,i){var r=function(){t.removeEventListener("transitionend",r),i()};t.addEventListener("transitionend",r,!1);var o=this.translateToPosition(t,e,"0.2");return o||(t.removeEventListener("transitionend",r),i()),o}toRelativeCoord(t){return a(t,"-",this.container)}toRealCoordinates(t){return a(t,"+",this.container)}getClientEventPos(t,e){return void 0!==t[e]?t[e]:void 0!==t.touches&&t.touches[0]&&t.touches[0][e]?t.touches[0][e]:void 0!==t.changedTouches&&t.changedTouches[0]&&t.changedTouches[0][e]?t.changedTouches[0][e]:0}}class s{constructor(t,e){this.x=t,this.y=e}clone(){return new s(this.x,this.y)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}Equal(t){return this.x===t.x&&this.y===t.y}LimitByRectangle(t){var e=Math.min(Math.max(this.y,t.top),t.bottom),i=Math.min(Math.max(this.x,t.left),t.right);return new s(i,e)}IsInRect(t){return t.left<=this.x&&this.x<=t.right&&t.top<=this.y&&this.y<=t.bottom}}class h{constructor(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r}clone(){return new h(this.x,this.y,this.width,this.height)}get left(){return this.x}get top(){return this.y}get bottom(){return this.y+this.height}get right(){return this.x+this.width}get size(){return new h(0,0,this.width,this.height)}get location(){return new h(this.x,this.y,0,0)}get center(){return new h(this.x+this.width/2,this.y+this.height/2,0,0)}get scalarLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}Equal(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}LimitByRectangle(t){var e=Math.min(Math.max(this.y,t.top),t.bottom),i=Math.min(Math.max(this.x,t.left),t.right);return new h(i,e,0,0)}}function a(){var t=Array.from(arguments),e=[],i=[];t.forEach((function(t){"-"===t||"+"===t?e.push(t):i.push(t)}));for(var r=[];i.length>0;)r.push(i.pop());for(;e.length>0;)r.push(e.shift());for(;r.length>0;){var o=r.shift();e.push("+"===o?l(e.pop(),e.pop()):"-"===o?c(e.pop(),e.pop()):o)}return e.pop()}function l(t,e){var i=u(t),r=u(e);return new h(i.x+r.x,i.y+r.y,i.width+r.width,i.height+r.height)}function c(t,e){var i=u(t),r=u(e);return new h(i.x-r.x,i.y-r.y,i.width-r.width,i.height-r.height)}function u(t){if(t.getBoundingClientRect)return g(t);var e=0,i=0,r=0,o=0;return t.x&&(e=t.x),t.y&&(i=t.y),t.width&&(r=t.width),t.height&&(o=t.height),{x:e,y:i,width:r,height:o}}function g(t){var e=t.getBoundingClientRect();return e&&e.left&&e.top&&!e.x&&!e.y&&(e.x=Math.min(e.left,e.right),e.y=Math.min(e.top,e.bottom)),new h(e.x,e.y,e.width,e.height)}const d={DragAndDropUnit:n,rectBlz:h,GetClientRect:g};export default d;export{n as DragAndDropUnit,g as GetClientRect,h as rectBlz};
